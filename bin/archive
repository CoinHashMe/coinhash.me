#!/usr/bin/env ruby

require 'rethinkdb'
require 'open-uri'

module Archive
  extend RethinkDB::Shortcuts

  def self.run
    r.connect(host: "ec2-23-21-221-6.compute-1.amazonaws.com", port: 28015).repl
    data = JSON.parse(open("http://pool.chunky.ms/api/pool/status").read)
    r.db('chunky').table('historical').insert(data.merge(created_at: Time.now)).run
  end
end

Archive.run
