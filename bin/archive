#!/usr/bin/env ruby

require 'rethinkdb'
require 'open-uri'

module Archive
  extend RethinkDB::Shortcuts

  def self.run
    r.connect(host: "localhost", port: 28015).repl
    data = JSON.parse(open("http://www.chunkypools.com/api/pool_info").read)
    r.db('chunky').table('historical').insert(data.merge(created_at: Time.now)).run
  end
end

Archive.run
